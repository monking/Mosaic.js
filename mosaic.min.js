(function(){var a,b;a=jQuery,b=function(){function b(b){null==b&&(b={}),this.options={container:a(document.body),itemSelector:"> *",fixed:"width",updateOnResize:!0,gutter:4,init:null},this.constructing=!0,this.applyOptions(b),this.constructing=!1}return b.prototype.BEFORE_ITEMS="mosaic-before-items",b.prototype.BEFORE_UPDATE="mosaic-before-update",b.prototype.AFTER_UPDATE="mosaic-after-items",b.prototype.REDRAW_CANCELED="mosaic-redraw-canceled",b.prototype.applyOptions=function(b){var c;return a.extend(this.options,b),this.options.container=a(this.options.container),this.options.container.css({width:"",height:""}),this.dimensions={fixed:this.options.fixed,flex:"width"===this.options.fixed?"height":"width"},this.containerSize={fixed:0/0,flex:0/0},this.axes={x:"width"===this.options.fixed?"left":"top",y:"width"===this.options.fixed?"top":"left"},c=this,this.constructing&&(this.resizeListener=function(){return c.redraw()},"function"==typeof this.options.init&&this.options.init.call(this)),a(function(){return a(window).unbind("resize",c.resizeListener),c.options.updateOnResize&&a(window).resize(function(){return c.resizeListener()}),c.redraw()})},b.prototype.bind=function(){return a.fn.bind.apply(this,arguments)},b.prototype.unbind=function(){return a.fn.unbind.apply(this,arguments)},b.prototype.redraw=function(b){var c,d;if(null==b&&(b=!1),this.drawing=!0,c=this.options.container[this.dimensions.fixed](),this.containerSize.fixed!==c||b){if(this.items=[],this.containerSize.fixed=this.options.container[this.dimensions.fixed](),a(this).trigger(this.BEFORE_ITEMS),!this.drawing)return;if(d=this,a(this.options.itemSelector,this.options.container).each(function(){var b;return b=a(this),d.items.push({x:0,y:0,fixed:0,flex:0,element:b})}),a(this).trigger(this.BEFORE_UPDATE),!this.drawing)return;this.siftAllItems(),this.updateContainerFlexSize(),a(this).trigger(this.AFTER_UPDATE)}else a(this).trigger(this.REDRAW_CANCELED);return this.drawing=!1},b.prototype.siftAllItems=function(){var a,b,c,d,e;for(this.firstSlot=[parseInt(this.options.container.css("padding-"+this.axes.x)),parseInt(this.options.container.css("padding-"+this.axes.y))],this.slots=[this.firstSlot],this.barriers=[[this.containerSize.fixed+this.options.gutter,null,null,null]],d=this.items,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.sift(a));return e},b.prototype.updateContainerFlexSize=function(){var a,b,c,d,e;for(b=0,e=this.items,c=0,d=e.length;d>c;c++)a=e[c],b=Math.max(a.y+a.flex,b);return this.containerSize.flex=b-this.firstSlot[1],this.options.container[this.dimensions.flex](this.containerSize.flex)},b.prototype.hitTest=function(a,b,c,d){var e,f;return null==c&&(c=0),null==d&&(d=[0,0]),2===b.length&&b.push(b[0],b[1]),a[0]+=d[0]-c+1,a[1]+=d[1]-c+1,a[2]+=d[0]+c-1,a[3]+=d[1]+c-1,e=!0,f=!0,null!==b[0]&&a[2]<b[0]&&(e=!1),null!==b[2]&&a[0]>b[2]&&(e=!1),null!==b[1]&&a[3]<b[1]&&(f=!1),null!==b[3]&&a[1]>b[3]&&(f=!1),e&&f},b.prototype.sift=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(a.hidden===!0)return void a.element.hide();for(a.element.show(),h=[],a.fixed=a.element[this.dimensions.fixed](),a.flex=a.element[this.dimensions.flex](),o=this.slots,c=i=0,l=o.length;l>i;c=++i){for(f=o[c],g=!1,p=this.barriers,j=0,m=p.length;m>j;j++)if(b=p[j],this.hitTest([0,0,a.fixed,a.flex],b,this.options.gutter,f)){g=!0;break}g||h.push(c)}for(e=this,h.sort(function(a,b){return e.slots[a][1]>e.slots[b][1]?1:e.slots[a][1]<e.slots[b][1]?-1:e.slots[a][0]>e.slots[b][0]?1:e.slots[a][0]<e.slots[b][0]?-1:0}),f=this.slots.splice(h[0],1)[0],a.x=f[0],a.y=f[1],d={position:"absolute"},d[this.axes.x]=""+a.x+"px",d[this.axes.y]=""+a.y+"px",a.element.css(d),c=0,q=this.slots,c=k=0,n=q.length;n>k;c=++k)f=q[c],f&&this.hitTest([a.x,a.y,a.x+a.fixed,a.y+a.flex],f)&&this.slots.splice(c--,1);return a.x+a.fixed+this.options.gutter<this.containerSize.fixed&&this.slots.push([a.x+a.fixed+this.options.gutter,a.y]),this.slots.push([a.x,a.y+a.flex+this.options.gutter]),this.barriers.push([a.x,a.y,a.x+a.fixed,a.y+a.flex])},b}(),window.Mosaic=b,jQuery.fn.mosaic=function(c){return null==c&&(c={}),a(this).each(function(){return c.container=a(this),c.container.data("mosaic",new b(c))})}}).call(this);